<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SuryaBright IoT Dashboard</title>
  <link rel="icon" type="image/png" href="images/blue-logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #f8fafc;
      color: #1e293b;
      overflow-x: hidden;
    }

    /* Top Header */
    .top-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: #ffffff;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      z-index: 1000;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      height: 32px;
    }

    .header-title {
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .city-selector select {
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      background: white;
      font-size: 14px;
      color: #374151;
      cursor: pointer;
      min-width: 120px;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: #f0f9ff;
      border: 1px solid #bae6fd;
      border-radius: 6px;
      font-size: 14px;
      color: #0369a1;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: #10b981;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .current-time {
      font-size: 14px;
      font-weight: 500;
      color: #6b7280;
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      left: 0;
      top: 60px;
      width: 240px;
      height: calc(100vh - 60px);
      background: #ffffff;
      border-right: 1px solid #e2e8f0;
      overflow-y: auto;
      z-index: 100;
    }

    .sidebar-section {
      padding: 16px 0;
      border-bottom: 1px solid #f1f5f9;
    }

    .sidebar-title {
      padding: 0 16px 8px;
      font-size: 12px;
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      padding: 10px 16px;
      color: #64748b;
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
    }

    .nav-item:hover,
    .nav-item.active {
      background: #f8fafc;
      color: #2563eb;
      border-right: 2px solid #2563eb;
    }

    .nav-item i {
      width: 20px;
      margin-right: 12px;
      text-align: center;
    }

    .nav-badge {
      margin-left: auto;
      background: #ef4444;
      color: white;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 10px;
      min-width: 18px;
      text-align: center;
    }

    /* Main Content */
    .main-content {
      margin-left: 240px;
      margin-top: 60px;
      padding: 24px;
      min-height: calc(100vh - 60px);
    }

    /* Stats Cards */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      margin: 0 auto 12px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .stat-icon.online { background: #dcfce7; color: #16a34a; }
    .stat-icon.offline { background: #fef2f2; color: #dc2626; }
    .stat-icon.power { background: #fef3c7; color: #d97706; }
    .stat-icon.efficiency { background: #dbeafe; color: #2563eb; }

    .stat-number {
      font-size: 24px;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 14px;
      color: #64748b;
    }

    /* Content Cards */
    .content-card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 24px;
    }

    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid #f1f5f9;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      color: #1e293b;
    }

    .card-body {
      padding: 20px;
    }

    /* Table */
    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th {
      text-align: left;
      padding: 12px;
      font-size: 12px;
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      background: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
    }

    .data-table td {
      padding: 12px;
      border-bottom: 1px solid #f1f5f9;
      font-size: 14px;
    }

    .data-table tr:hover {
      background: #f8fafc;
    }

    /* Status badges */
    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-badge.online { background: #dcfce7; color: #166534; }
    .status-badge.offline { background: #fef2f2; color: #991b1b; }
    .status-badge.maintenance { background: #fef3c7; color: #92400e; }

    /* Battery indicator */
    .battery {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .battery-bar {
      width: 60px;
      height: 8px;
      background: #f1f5f9;
      border-radius: 4px;
      overflow: hidden;
    }

    .battery-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #34d399);
      border-radius: 4px;
      transition: width 0.3s;
    }

    .battery-fill.low { background: linear-gradient(90deg, #ef4444, #f87171); }
    .battery-fill.medium { background: linear-gradient(90deg, #f59e0b, #fbbf24); }

    /* Action buttons */
    .action-btn {
      padding: 6px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      background: white;
      color: #374151;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .action-btn:hover {
      background: #f3f4f6;
      border-color: #9ca3af;
    }

    .action-btn.primary {
      background: #2563eb;
      color: white;
      border-color: #2563eb;
    }

    .action-btn.primary:hover {
      background: #1d4ed8;
    }

    /* Location cards */
    .locations-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }

    .location-card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 16px;
    }

    .location-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .location-name {
      font-size: 14px;
      font-weight: 600;
      color: #1e293b;
    }

    .location-status {
      font-size: 12px;
      color: #64748b;
    }

    .location-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      text-align: center;
    }

    .location-stat-number {
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
    }

    .location-stat-label {
      font-size: 11px;
      color: #64748b;
    }

    /* View switching */
    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    /* Real-time indicators */
    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: #059669;
      font-weight: 500;
    }

    .live-dot {
      width: 6px;
      height: 6px;
      background: #10b981;
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }

    /* Dashboard Grid */
    .dashboard-grid {
      display: grid;
      gap: 24px;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }

    /* Chart placeholder */
    .chart-container {
      height: 200px;
      background: #f8fafc;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #64748b;
      font-size: 14px;
      border: 2px dashed #e2e8f0;
      flex-direction: column;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s;
      }

      .main-content {
        margin-left: 0;
      }

      .stats-row {
        grid-template-columns: repeat(2, 1fr);
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Control Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
    }

    .modal-content {
      background-color: white;
      margin: 5% auto;
      padding: 0;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
    }

    .close {
      color: #64748b;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      border: none;
      background: none;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .close:hover {
      color: #1e293b;
      background: #f1f5f9;
    }

    .modal-body {
      padding: 20px;
    }

    .control-group {
      margin-bottom: 20px;
    }

    .control-label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 500;
      color: #374151;
    }

    .control-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .control-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .control-toggle {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .toggle-switch {
      position: relative;
      width: 44px;
      height: 24px;
      background: #d1d5db;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle-switch.active {
      background: #2563eb;
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .toggle-switch.active::after {
      transform: translateX(20px);
    }

    .modal-footer {
      padding: 20px;
      border-top: 1px solid #e2e8f0;
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    .btn-modal {
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid;
    }

    .btn-modal.primary {
      background: #2563eb;
      color: white;
      border-color: #2563eb;
    }

    .btn-modal.primary:hover {
      background: #1d4ed8;
    }

    .btn-modal.secondary {
      background: white;
      color: #374151;
      border-color: #d1d5db;
    }

    .btn-modal.secondary:hover {
      background: #f9fafb;
    }
  </style>
</head>
<body>
  <!-- Top Header -->
  <div class="top-header">
    <div class="header-left">
      <img src="images/blue-logo.png" alt="SuryaBright" class="logo">
      <span class="header-title">IoT Dashboard</span>
    </div>
    <div class="header-right">
      <div class="city-selector">
        <select id="citySelect" onchange="switchCity()">
          <option value="surabaya">Surabaya</option>
          <option value="jakarta">Jakarta</option>
          <option value="bandung">Bandung</option>
          <option value="sidoarjo">Sidoarjo</option>
          <option value="gresik">Gresik</option>
        </select>
      </div>
      <div class="status-indicator">
        <div class="status-dot"></div>
        <span>System Online</span>
      </div>
      <div class="current-time" id="currentTime"></div>
    </div>
  </div>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">Main</div>
      <a class="nav-item active" onclick="showView('dashboard', this)">
        <i class="fas fa-th-large"></i>
        <span>Dashboard</span>
      </a>
      <a class="nav-item" onclick="showView('devices', this)">
        <i class="fas fa-lightbulb"></i>
        <span>Street Lights</span>
      </a>
      <a class="nav-item" onclick="showView('map', this)">
        <i class="fas fa-map-marked-alt"></i>
        <span>Map View</span>
      </a>
    </div>
    
    <div class="sidebar-section">
      <div class="sidebar-title">Monitoring</div>
      <a class="nav-item" onclick="showView('analytics', this)">
        <i class="fas fa-chart-line"></i>
        <span>Analytics</span>
      </a>
      <a class="nav-item" onclick="showView('alerts', this)">
        <i class="fas fa-bell"></i>
        <span>Alerts</span>
        <span class="nav-badge">3</span>
      </a>
      <a class="nav-item" onclick="showView('reports', this)">
        <i class="fas fa-file-alt"></i>
        <span>Reports</span>
      </a>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-title">System</div>
      <a class="nav-item" onclick="showView('settings', this)">
        <i class="fas fa-cog"></i>
        <span>Settings</span>
      </a>
      <a class="nav-item" href="index.html">
        <i class="fas fa-sign-out-alt"></i>
        <span>Exit Dashboard</span>
      </a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Dashboard View -->
    <div id="dashboard" class="view active">
      <!-- Stats Row -->
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-icon online">
            <i class="fas fa-lightbulb"></i>
          </div>
          <div class="stat-number" id="onlineCount">42</div>
          <div class="stat-label">Online Lights</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon offline">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="stat-number" id="offlineCount">3</div>
          <div class="stat-label">Offline Lights</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon power">
            <i class="fas fa-bolt"></i>
          </div>
          <div class="stat-number" id="powerGenerated">2.4kW</div>
          <div class="stat-label">Power Generated</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon efficiency">
            <i class="fas fa-leaf"></i>
          </div>
          <div class="stat-number" id="efficiency">94%</div>
          <div class="stat-label">Efficiency</div>
        </div>
      </div>

      <!-- Main Dashboard Grid -->
      <div class="dashboard-grid">
        <!-- Recent Activity -->
        <div class="content-card">
          <div class="card-header">
            <div class="card-title">Recent Activity</div>
            <div class="live-indicator">
              <div class="live-dot"></div>
              Live
            </div>
          </div>
          <div class="card-body">
            <div id="activityLog" style="max-height: 200px; overflow-y: auto;">
              <!-- Activity items will be populated here -->
            </div>
          </div>
        </div>

        <!-- Power Consumption Chart -->
        <div class="content-card">
          <div class="card-header">
            <div class="card-title">Power Consumption (24h)</div>
            <button class="action-btn">View Details</button>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <i class="fas fa-chart-area" style="font-size: 32px; margin-bottom: 8px; color: #94a3b8;"></i>
              <div>Interactive power consumption chart</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Locations Overview -->
      <div class="content-card">
        <div class="card-header">
          <div class="card-title">Locations Overview - <span id="currentCityName">Surabaya</span></div>
          <button class="action-btn primary" onclick="refreshData()">
            <i class="fas fa-sync-alt"></i> Refresh
          </button>
        </div>
        <div class="card-body">
          <div class="locations-grid" id="locationsGrid">
            <!-- Location cards will be populated here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Devices View -->
    <div id="devices" class="view">
      <div class="content-card">
        <div class="card-header">
          <div class="card-title">Street Lights Management</div>
          <div style="display: flex; gap: 8px;">
            <button class="action-btn">
              <i class="fas fa-filter"></i> Filter
            </button>
            <button class="action-btn primary">
              <i class="fas fa-plus"></i> Add Device
            </button>
          </div>
        </div>
        <div class="card-body" style="padding: 0; overflow-x: auto;">
          <table class="data-table">
            <thead>
              <tr>
                <th>Device ID</th>
                <th>Location</th>
                <th>Status</th>
                <th>Battery</th>
                <th>Temperature</th>
                <th>Last Update</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="devicesTable">
              <!-- Device rows will be populated here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Map View -->
    <div id="map" class="view">
      <div class="content-card">
        <div class="card-header">
          <div class="card-title">Street Lights Map - Surabaya</div>
          <div style="display: flex; gap: 8px;">
            <button class="action-btn" onclick="toggleMapType('satellite')">
              <i class="fas fa-satellite"></i> Satellite
            </button>
            <button class="action-btn" onclick="toggleMapType('roadmap')">
              <i class="fas fa-map"></i> Roadmap
            </button>
            <button class="action-btn" onclick="showAllLights()">
              <i class="fas fa-lightbulb"></i> Show Lights
            </button>
          </div>
        </div>
        <div class="card-body" style="padding: 0;">
          <iframe 
            id="mapFrame"
            width="100%" 
            height="500" 
            frameborder="0" 
            style="border:0; border-radius: 0 0 8px 8px;" 
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d126646.23706890775!2d112.63708275544432!3d-7.275618299999999!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2dd7fbf8381ac47f%3A0x3027a76e352be40!2sSurabaya%2C%20East%20Java%2C%20Indonesia!5e0!3m2!1sen!2sus!4v1735563600000!5m2!1sen!2sus" 
            allowfullscreen>
          </iframe>
        </div>
      </div>
    </div>

    <!-- Analytics View -->
    <div id="analytics" class="view">
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-icon power">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="stat-number" id="totalKwh">1,247</div>
          <div class="stat-label">Total kWh Generated</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon efficiency">
            <i class="fas fa-money-bill-wave"></i>
          </div>
          <div class="stat-number" id="costSavings">$342</div>
          <div class="stat-label">Cost Savings</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon online">
            <i class="fas fa-leaf"></i>
          </div>
          <div class="stat-number" id="co2Reduced">0.8t</div>
          <div class="stat-label">CO₂ Reduced</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon efficiency">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-number" id="uptime">99.2%</div>
          <div class="stat-label">System Uptime</div>
        </div>
      </div>
      
      <div class="dashboard-grid">
        <div class="content-card">
          <div class="card-header">
            <div class="card-title">Daily Energy Production (Last 7 Days)</div>
            <button class="action-btn" onclick="exportChart('energy')">
              <i class="fas fa-download"></i> Export
            </button>
          </div>
          <div class="card-body">
            <div id="energyChart" style="height: 250px; position: relative;">
              <!-- Fake Chart Data -->
              <div style="display: flex; align-items: end; justify-content: space-around; height: 200px; padding: 20px 0; border-bottom: 2px solid #e2e8f0;">
                <div style="display: flex; flex-direction: column; align-items: center;">
                  <div style="width: 40px; height: 120px; background: linear-gradient(to top, #3b82f6, #60a5fa); border-radius: 4px 4px 0 0; margin-bottom: 8px;"></div>
                  <span style="font-size: 12px; color: #64748b;">Mon</span>
                  <span style="font-size: 11px; color: #94a3b8;">24.5 kWh</span>
                </div>
                <div style="display: flex; flex-direction: column; align-items: center;">
                  <div style="width: 40px; height: 95px; background: linear-gradient(to top, #3b82f6, #60a5fa); border-radius: 4px 4px 0 0; margin-bottom: 8px;"></div>
                  <span style="font-size: 12px; color: #64748b;">Tue</span>
                  <span style="font-size: 11px; color: #94a3b8;">19.8 kWh</span>
                </div>
                <div style="display: flex; flex-direction: column; align-items: center;">
                  <div style="width: 40px; height: 140px; background: linear-gradient(to top, #3b82f6, #60a5fa); border-radius: 4px 4px 0 0; margin-bottom: 8px;"></div>
                  <span style="font-size: 12px; color: #64748b;">Wed</span>
                  <span style="font-size: 11px; color: #94a3b8;">28.2 kWh</span>
                </div>
                <div style="display: flex; flex-direction: column; align-items: center;">
                  <div style="width: 40px; height: 110px; background: linear-gradient(to top, #3b82f6, #60a5fa); border-radius: 4px 4px 0 0; margin-bottom: 8px;"></div>
                  <span style="font-size: 12px; color: #64748b;">Thu</span>
                  <span style="font-size: 11px; color: #94a3b8;">22.7 kWh</span>
                </div>
                <div style="display: flex; flex-direction: column; align-items: center;">
                  <div style="width: 40px; height: 160px; background: linear-gradient(to top, #3b82f6, #60a5fa); border-radius: 4px 4px 0 0; margin-bottom: 8px;"></div>
                  <span style="font-size: 12px; color: #64748b;">Fri</span>
                  <span style="font-size: 11px; color: #94a3b8;">32.1 kWh</span>
                </div>
                <div style="display: flex; flex-direction: column; align-items: center;">
                  <div style="width: 40px; height: 85px; background: linear-gradient(to top, #3b82f6, #60a5fa); border-radius: 4px 4px 0 0; margin-bottom: 8px;"></div>
                  <span style="font-size: 12px; color: #64748b;">Sat</span>
                  <span style="font-size: 11px; color: #94a3b8;">17.4 kWh</span>
                </div>
                <div style="display: flex; flex-direction: column; align-items: center;">
                  <div style="width: 40px; height: 75px; background: linear-gradient(to top, #3b82f6, #60a5fa); border-radius: 4px 4px 0 0; margin-bottom: 8px;"></div>
                  <span style="font-size: 12px; color: #64748b;">Sun</span>
                  <span style="font-size: 11px; color: #94a3b8;">15.3 kWh</span>
                </div>
              </div>
              <div style="margin-top: 15px; text-align: center; color: #64748b; font-size: 14px;">
                Average: 22.9 kWh/day | Peak: 32.1 kWh | Total Week: 160.0 kWh
              </div>
            </div>
          </div>
        </div>
        
        <div class="content-card">
          <div class="card-header">
            <div class="card-title">Performance Metrics</div>
            <button class="action-btn" onclick="refreshMetrics()">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
          </div>
          <div class="card-body">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
              <div style="text-align: center; padding: 15px; background: #f0f9ff; border-radius: 8px;">
                <div style="font-size: 24px; font-weight: 700; color: #0369a1;">94.8%</div>
                <div style="font-size: 12px; color: #64748b;">Battery Efficiency</div>
              </div>
              <div style="text-align: center; padding: 15px; background: #f0fdf4; border-radius: 8px;">
                <div style="font-size: 24px; font-weight: 700; color: #16a34a;">99.2%</div>
                <div style="font-size: 12px; color: #64748b;">Network Uptime</div>
              </div>
              <div style="text-align: center; padding: 15px; background: #fefbeb; border-radius: 8px;">
                <div style="font-size: 24px; font-weight: 700; color: #d97706;">8.2h</div>
                <div style="font-size: 12px; color: #64748b;">Avg Daily Runtime</div>
              </div>
              <div style="text-align: center; padding: 15px; background: #fdf2f8; border-radius: 8px;">
                <div style="font-size: 24px; font-weight: 700; color: #be185d;">2.1°C</div>
                <div style="font-size: 12px; color: #64748b;">Temp Variance</div>
              </div>
            </div>
            <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
              <div style="font-size: 14px; font-weight: 600; color: #1e293b; margin-bottom: 10px;">System Health Indicators</div>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <span style="font-size: 13px; color: #64748b;">Solar Panel Performance</span>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <div style="width: 100px; height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden;">
                    <div style="width: 92%; height: 100%; background: #16a34a;"></div>
                  </div>
                  <span style="font-size: 12px; color: #16a34a; font-weight: 600;">92%</span>
                </div>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <span style="font-size: 13px; color: #64748b;">Communication Signal</span>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <div style="width: 100px; height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden;">
                    <div style="width: 87%; height: 100%; background: #3b82f6;"></div>
                  </div>
                  <span style="font-size: 12px; color: #3b82f6; font-weight: 600;">87%</span>
                </div>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="font-size: 13px; color: #64748b;">Maintenance Score</span>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <div style="width: 100px; height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden;">
                    <div style="width: 95%; height: 100%; background: #059669;"></div>
                  </div>
                  <span style="font-size: 12px; color: #059669; font-weight: 600;">95%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Alerts View -->
    <div id="alerts" class="view">
      <div class="content-card">
        <div class="card-header">
          <div class="card-title">System Alerts</div>
          <button class="action-btn">Mark All Read</button>
        </div>
        <div class="card-body" id="alertsList">
          <!-- Alerts will be populated here -->
        </div>
      </div>
    </div>

    <!-- Reports View -->
    <div id="reports" class="view">
      <div class="content-card">
        <div class="card-header">
          <div class="card-title">Generated Reports</div>
          <button class="action-btn primary">
            <i class="fas fa-plus"></i> Generate Report
          </button>
        </div>
        <div class="card-body">
          <div style="text-align: center; padding: 40px;">
            <i class="fas fa-file-alt" style="font-size: 48px; color: #94a3b8; margin-bottom: 16px;"></i>
            <div style="font-size: 16px; color: #475569; margin-bottom: 8px;">No reports generated yet</div>
            <div style="color: #64748b;">Click "Generate Report" to create your first report</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings View -->
    <div id="settings" class="view">
      <div class="content-card">
        <div class="card-header">
          <div class="card-title">System Settings</div>
        </div>
        <div class="card-body">
          <div style="max-width: 600px;">
            <div style="margin-bottom: 24px;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500;">Refresh Interval</label>
              <select style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px;">
                <option>30 seconds</option>
                <option>1 minute</option>
                <option>5 minutes</option>
              </select>
            </div>
            <div style="margin-bottom: 24px;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500;">Alert Notifications</label>
              <label style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" checked> Enable email notifications
              </label>
            </div>
            <div style="margin-bottom: 24px;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500;">Temperature Unit</label>
              <select style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px;">
                <option>Celsius (°C)</option>
                <option>Fahrenheit (°F)</option>
              </select>
            </div>
            <button class="action-btn primary">Save Settings</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Control Modal -->
  <div id="controlModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Device Control - <span id="modalDeviceId"></span></div>
        <button class="close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="control-group">
          <label class="control-label">Device Status</label>
          <div class="control-toggle">
            <div class="toggle-switch" id="powerToggle" onclick="togglePower()"></div>
            <span id="powerStatus">Online</span>
          </div>
        </div>
        
        <div class="control-group">
          <label class="control-label">Brightness Level (%)</label>
          <input type="range" class="control-input" id="brightnessSlider" min="0" max="100" value="75" oninput="updateBrightness(this.value)">
          <div style="text-align: center; margin-top: 8px; font-size: 14px; color: #64748b;">
            Current: <span id="brightnessValue">75</span>%
          </div>
        </div>

        <div class="control-group">
          <label class="control-label">Auto Mode</label>
          <div class="control-toggle">
            <div class="toggle-switch active" id="autoToggle" onclick="toggleAuto()"></div>
            <span id="autoStatus">Enabled</span>
          </div>
        </div>

        <div class="control-group">
          <label class="control-label">Schedule Timer (Hours)</label>
          <select class="control-input" id="scheduleSelect">
            <option value="0">Manual Control</option>
            <option value="6">6 Hours</option>
            <option value="8" selected>8 Hours</option>
            <option value="10">10 Hours</option>
            <option value="12">12 Hours</option>
            <option value="custom">Custom</option>
          </select>
        </div>

        <div class="control-group">
          <label class="control-label">Energy Saving Mode</label>
          <div class="control-toggle">
            <div class="toggle-switch" id="ecoToggle" onclick="toggleEco()"></div>
            <span id="ecoStatus">Disabled</span>
          </div>
        </div>

        <div style="background: #f8fafc; padding: 16px; border-radius: 8px; margin-top: 20px;">
          <div style="font-size: 14px; font-weight: 600; color: #1e293b; margin-bottom: 12px;">Current Status</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 13px;">
            <div>
              <span style="color: #64748b;">Battery:</span>
              <span style="font-weight: 600; color: #16a34a;" id="modalBattery">85%</span>
            </div>
            <div>
              <span style="color: #64748b;">Temperature:</span>
              <span style="font-weight: 600; color: #0369a1;" id="modalTemp">32°C</span>
            </div>
            <div>
              <span style="color: #64748b;">Signal:</span>
              <span style="font-weight: 600; color: #059669;">Strong</span>
            </div>
            <div>
              <span style="color: #64748b;">Last Update:</span>
              <span style="font-weight: 600; color: #64748b;">2 min ago</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-modal secondary" onclick="closeModal()">Cancel</button>
        <button class="btn-modal primary" onclick="saveSettings()">Apply Settings</button>
      </div>
    </div>
  </div>

  <script>
    // City data
    const cityData = {
      surabaya: {
        name: 'Surabaya',
        locations: [
          { name: 'Keputih', lights: 8, online: 7, offline: 1, avgBattery: 85 },
          { name: 'Semolowaru', lights: 12, online: 11, offline: 1, avgBattery: 92 },
          { name: 'Nginden', lights: 6, online: 6, offline: 0, avgBattery: 78 },
          { name: 'Mulyosari', lights: 9, online: 8, offline: 1, avgBattery: 88 },
          { name: 'Tenggilis', lights: 8, online: 8, offline: 0, avgBattery: 94 }
        ]
      },
      jakarta: {
        name: 'Jakarta',
        locations: [
          { name: 'Menteng', lights: 15, online: 14, offline: 1, avgBattery: 87 },
          { name: 'Sudirman', lights: 20, online: 19, offline: 1, avgBattery: 91 },
          { name: 'Kuningan', lights: 12, online: 12, offline: 0, avgBattery: 83 },
          { name: 'Kemang', lights: 10, online: 9, offline: 1, avgBattery: 89 }
        ]
      },
      bandung: {
        name: 'Bandung',
        locations: [
          { name: 'Dago', lights: 14, online: 13, offline: 1, avgBattery: 86 },
          { name: 'Cihampelas', lights: 11, online: 11, offline: 0, avgBattery: 90 },
          { name: 'Setiabudi', lights: 8, online: 7, offline: 1, avgBattery: 82 }
        ]
      },
      sidoarjo: {
        name: 'Sidoarjo',
        locations: [
          { name: 'Waru', lights: 7, online: 7, offline: 0, avgBattery: 88 },
          { name: 'Taman', lights: 6, online: 5, offline: 1, avgBattery: 85 },
          { name: 'Gedangan', lights: 5, online: 5, offline: 0, avgBattery: 92 }
        ]
      },
      gresik: {
        name: 'Gresik',
        locations: [
          { name: 'Cerme', lights: 5, online: 5, offline: 0, avgBattery: 89 },
          { name: 'Kebomas', lights: 7, online: 6, offline: 1, avgBattery: 84 },
          { name: 'Manyar', lights: 4, online: 4, offline: 0, avgBattery: 91 }
        ]
      }
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      updateClock();
      setInterval(updateClock, 1000);
      loadCityData('surabaya');
      loadDevicesTable();
      loadActivityLog();
      loadAlerts();
      
      // Auto-refresh data every 30 seconds
      setInterval(() => {
        loadCityData(document.getElementById('citySelect').value);
        updateActivityLog();
      }, 30000);
    });

    // Update clock
    function updateClock() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('en-US', { 
        hour12: false,
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
      document.getElementById('currentTime').textContent = timeString;
    }

    // Switch city
    function switchCity() {
      const selectedCity = document.getElementById('citySelect').value;
      loadCityData(selectedCity);
    }

    // Load city data
    function loadCityData(city) {
      const data = cityData[city];
      document.getElementById('currentCityName').textContent = data.name;
      
      // Update stats
      const totalLights = data.locations.reduce((sum, loc) => sum + loc.lights, 0);
      const totalOnline = data.locations.reduce((sum, loc) => sum + loc.online, 0);
      const totalOffline = data.locations.reduce((sum, loc) => sum + loc.offline, 0);
      
      document.getElementById('onlineCount').textContent = totalOnline;
      document.getElementById('offlineCount').textContent = totalOffline;
      
      // Update power and efficiency with some variation
      const powerGenerated = (totalOnline * 0.05 + Math.random() * 0.5).toFixed(1);
      const efficiency = Math.floor(90 + Math.random() * 8);
      
      document.getElementById('powerGenerated').textContent = powerGenerated + 'kW';
      document.getElementById('efficiency').textContent = efficiency + '%';
      
      // Update locations grid
      const grid = document.getElementById('locationsGrid');
      grid.innerHTML = data.locations.map(location => `
        <div class="location-card">
          <div class="location-header">
            <div class="location-name">${location.name}</div>
            <div class="location-status">${location.lights} lights</div>
          </div>
          <div class="location-stats">
            <div>
              <div class="location-stat-number">${location.online}</div>
              <div class="location-stat-label">Online</div>
            </div>
            <div>
              <div class="location-stat-number">${location.offline}</div>
              <div class="location-stat-label">Offline</div>
            </div>
            <div>
              <div class="location-stat-number">${location.avgBattery}%</div>
              <div class="location-stat-label">Avg Battery</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Show view
    function showView(viewId, navElement) {
      // Hide all views
      document.querySelectorAll('.view').forEach(view => {
        view.classList.remove('active');
      });
      
      // Show selected view
      document.getElementById(viewId).classList.add('active');
      
      // Update navigation
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      navElement.classList.add('active');
    }

    // Load devices table
    function loadDevicesTable() {
      const tbody = document.getElementById('devicesTable');
      const devices = generateDeviceData();
      
      tbody.innerHTML = devices.map(device => `
        <tr>
          <td>${device.id}</td>
          <td>${device.location}</td>
          <td><span class="status-badge ${device.status}">${device.status}</span></td>
          <td>
            <div class="battery">
              <div class="battery-bar">
                <div class="battery-fill ${getBatteryClass(device.battery)}" style="width: ${device.battery}%"></div>
              </div>
              <span>${device.battery}%</span>
            </div>
          </td>
          <td>${device.temperature}°C</td>
          <td>${device.lastUpdate}</td>
          <td>
            <button class="action-btn" onclick="controlDevice('${device.id}')">
              <i class="fas fa-cog"></i>
            </button>
          </td>
        </tr>
      `).join('');
    }

    // Generate device data
    function generateDeviceData() {
      const locations = ['Keputih', 'Semolowaru', 'Nginden', 'Mulyosari', 'Tenggilis'];
      const statuses = ['online', 'offline', 'maintenance'];
      const devices = [];
      
      for (let i = 1; i <= 20; i++) {
        const status = i % 8 === 0 ? 'offline' : i % 12 === 0 ? 'maintenance' : 'online';
        devices.push({
          id: `SL-${String(i).padStart(3, '0')}`,
          location: locations[Math.floor(Math.random() * locations.length)],
          status: status,
          battery: Math.floor(Math.random() * 40 + 60),
          temperature: Math.floor(Math.random() * 10 + 28),
          lastUpdate: `${Math.floor(Math.random() * 10) + 1} min ago`
        });
      }
      
      return devices;
    }

    // Get battery class for styling
    function getBatteryClass(battery) {
      if (battery < 30) return 'low';
      if (battery < 60) return 'medium';
      return '';
    }

    // Load activity log
    function loadActivityLog() {
      const activities = [
        { type: 'success', message: 'SL-023 came online', time: '2 min ago' },
        { type: 'warning', message: 'Low battery detected on SL-045', time: '5 min ago' },
        { type: 'info', message: 'Scheduled maintenance for SL-012', time: '8 min ago' },
        { type: 'success', message: 'System backup completed', time: '15 min ago' },
        { type: 'warning', message: 'High temperature on SL-067', time: '22 min ago' }
      ];
      
      const activityLog = document.getElementById('activityLog');
      activityLog.innerHTML = activities.map(activity => `
        <div style="display: flex; align-items: center; padding: 8px 0; border-bottom: 1px solid #f1f5f9;">
          <div style="width: 8px; height: 8px; border-radius: 50%; margin-right: 12px; background: ${getActivityColor(activity.type)};"></div>
          <div style="flex: 1;">
            <div style="font-size: 14px; color: #1e293b;">${activity.message}</div>
            <div style="font-size: 12px; color: #64748b;">${activity.time}</div>
          </div>
        </div>
      `).join('');
    }

    // Update activity log with new entry
    function updateActivityLog() {
      const newActivities = [
        'New device connected',
        'Battery level updated',
        'Status sync completed',
        'Temperature reading received'
      ];
      
      const randomActivity = newActivities[Math.floor(Math.random() * newActivities.length)];
      console.log('New activity:', randomActivity);
    }

    // Get activity color
    function getActivityColor(type) {
      switch(type) {
        case 'success': return '#10b981';
        case 'warning': return '#f59e0b';
        case 'error': return '#ef4444';
        default: return '#6b7280';
      }
    }

    // Load alerts
    function loadAlerts() {
      const alerts = [
        { type: 'warning', title: 'Low Battery Alert', message: 'SL-023 battery level is below 20%', time: '5 min ago' },
        { type: 'error', title: 'Connection Lost', message: 'Unable to connect to SL-045', time: '12 min ago' },
        { type: 'info', title: 'Maintenance Scheduled', message: 'Routine maintenance for Zone A', time: '1 hour ago' }
      ];
      
      const alertsList = document.getElementById('alertsList');
      alertsList.innerHTML = alerts.map(alert => `
        <div style="padding: 16px; border-left: 4px solid ${getAlertColor(alert.type)}; background: ${getAlertBg(alert.type)}; margin-bottom: 12px; border-radius: 0 6px 6px 0;">
          <div style="font-weight: 600; margin-bottom: 4px; color: #1e293b;">${alert.title}</div>
          <div style="font-size: 14px; color: #64748b; margin-bottom: 8px;">${alert.message}</div>
          <div style="font-size: 12px; color: #9ca3af;">${alert.time}</div>
        </div>
      `).join('');
    }

    // Get alert colors
    function getAlertColor(type) {
      switch(type) {
        case 'warning': return '#f59e0b';
        case 'error': return '#ef4444';
        default: return '#3b82f6';
      }
    }

    function getAlertBg(type) {
      switch(type) {
        case 'warning': return '#fefbeb';
        case 'error': return '#fef2f2';
        default: return '#eff6ff';
      }
    }

    // Refresh data
    function refreshData() {
      const selectedCity = document.getElementById('citySelect').value;
      loadCityData(selectedCity);
      loadDevicesTable();
      loadActivityLog();
      
      // Show success message
      setTimeout(() => {
        alert('Data refreshed successfully!');
      }, 500);
    }

    // Control device (enhanced modal function)
    function controlDevice(deviceId) {
      // Set device ID in modal
      document.getElementById('modalDeviceId').textContent = deviceId;
      
      // Get device data (simulate fetching current settings)
      const deviceData = getCurrentDeviceData(deviceId);
      
      // Update modal with device data
      document.getElementById('modalBattery').textContent = deviceData.battery + '%';
      document.getElementById('modalTemp').textContent = deviceData.temperature + '°C';
      
      // Show modal
      document.getElementById('controlModal').style.display = 'block';
    }

    // Get current device data (simulated)
    function getCurrentDeviceData(deviceId) {
      return {
        battery: Math.floor(Math.random() * 40 + 60),
        temperature: Math.floor(Math.random() * 10 + 28),
        brightness: 75,
        isOnline: true,
        autoMode: true,
        ecoMode: false
      };
    }

    // Modal control functions
    function closeModal() {
      document.getElementById('controlModal').style.display = 'none';
    }

    function togglePower() {
      const toggle = document.getElementById('powerToggle');
      const status = document.getElementById('powerStatus');
      
      if (toggle.classList.contains('active')) {
        toggle.classList.remove('active');
        status.textContent = 'Offline';
        status.style.color = '#dc2626';
      } else {
        toggle.classList.add('active');
        status.textContent = 'Online';
        status.style.color = '#16a34a';
      }
    }

    function toggleAuto() {
      const toggle = document.getElementById('autoToggle');
      const status = document.getElementById('autoStatus');
      
      if (toggle.classList.contains('active')) {
        toggle.classList.remove('active');
        status.textContent = 'Disabled';
        status.style.color = '#64748b';
      } else {
        toggle.classList.add('active');
        status.textContent = 'Enabled';
        status.style.color = '#16a34a';
      }
    }

    function toggleEco() {
      const toggle = document.getElementById('ecoToggle');
      const status = document.getElementById('ecoStatus');
      
      if (toggle.classList.contains('active')) {
        toggle.classList.remove('active');
        status.textContent = 'Disabled';
        status.style.color = '#64748b';
      } else {
        toggle.classList.add('active');
        status.textContent = 'Enabled';
        status.style.color = '#16a34a';
      }
    }

    function updateBrightness(value) {
      document.getElementById('brightnessValue').textContent = value;
    }

    function saveSettings() {
      const deviceId = document.getElementById('modalDeviceId').textContent;
      const brightness = document.getElementById('brightnessSlider').value;
      const schedule = document.getElementById('scheduleSelect').value;
      
      // Simulate saving settings
      setTimeout(() => {
        alert(`Settings saved for ${deviceId}:\n- Brightness: ${brightness}%\n- Schedule: ${schedule} hours\n- Settings applied successfully!`);
        closeModal();
        
        // Refresh the devices table to show updated data
        loadDevicesTable();
      }, 500);
    }

    // Map functions
    function toggleMapType(type) {
      const iframe = document.getElementById('mapFrame');
      let newSrc = iframe.src;
      
      if (type === 'satellite') {
        newSrc = newSrc.replace('!4f13.1!', '!4f13.1!6e1!'); // Add satellite view parameter
        alert('Switched to satellite view');
      } else {
        newSrc = newSrc.replace('!6e1!', ''); // Remove satellite view parameter
        alert('Switched to roadmap view');
      }
      
      // Note: Google Maps embed has limitations for dynamic switching
      console.log('Map type changed to:', type);
    }

    function showAllLights() {
      alert('Showing all 45 street lights in Surabaya area:\n\n✅ 42 Online lights\n❌ 3 Offline lights\n\nClick on individual markers to view device details.');
    }

    // Analytics functions
    function exportChart(chartType) {
      alert(`Exporting ${chartType} chart data...\n\nFormat: CSV\nData range: Last 30 days\nFile will be downloaded shortly.`);
    }

    function refreshMetrics() {
      // Simulate refreshing metrics with slight variations
      const elements = ['totalKwh', 'costSavings', 'co2Reduced', 'uptime'];
      const values = ['1,247', '$342', '0.8t', '99.2%'];
      
      elements.forEach((id, index) => {
        const element = document.getElementById(id);
        if (element) {
          // Add a subtle animation effect
          element.style.opacity = '0.5';
          setTimeout(() => {
            // Simulate slight data changes
            let newValue = values[index];
            if (id === 'totalKwh') newValue = (1247 + Math.floor(Math.random() * 10)).toLocaleString();
            if (id === 'costSavings') newValue = '$' + (342 + Math.floor(Math.random() * 20));
            if (id === 'uptime') newValue = (99.2 + (Math.random() * 0.6 - 0.3)).toFixed(1) + '%';
            
            element.textContent = newValue;
            element.style.opacity = '1';
          }, 500);
        }
      });
      
      setTimeout(() => {
        alert('Metrics refreshed successfully!');
      }, 800);
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('controlModal');
      if (event.target === modal) {
        closeModal();
      }
    }
  </script>
</body>
</html>
